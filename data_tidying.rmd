---
title: "Data Tidying"
author: "Joshua A. Harkness"
date: "2024-03-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-data-files, message = FALSE}
plots <- read_csv("/cloud/project/data/hf131-01-plot.csv")
trees <- read_csv("/cloud/project/data/hf131-02-tree.csv")
cwd <- read_csv("/cloud/project/data/hf131-03-cwd.csv")
aco <- read_csv("/cloud/project/data/hf131-04-aco.csv")
pc <- read_csv("/cloud/project/data/hf131-05-pc-abund.csv")
herps <- read_csv("/cloud/project/data/hf131-06-herps.csv")
```

```{r}
n_distinct(pc$pc.no)
```
250 uniquely identified P. cinereus according to this data file.  Does not include zeros so not useful for presence/absence.

```{r}
aco_abund <- aco %>%
  summarize(n_ind = sum(pca))

sum(aco_abund$n_ind)
```
241 individuals according to this data file, which includes all non-observations as zeroes.

I'm going with 241 as reported by the sum of `n_ind` as reported above as it is more conservative than the 250 from the `pc` file and includes zeroes which are useful for modeling presence/absence.  Erroneous count data that I used previously resulted from joining these data files with `plots`, which apparently duplicated some rows and gave higher counts.

```{r}
aco_uncount <- aco %>%
  uncount(pca, .remove = FALSE)

aco_uncount
```
Using `uncount` weighted by `pca` changes the dataframe such that each row now represents an individual observed P. cinereus instead of a count of P. cinereus observed at a specific cover board during a sampling event.  Once again, however, we are not including zeros in this dataset.

### Joining data files
```{r}
df_abund <- left_join(aco, plots)
# Not joinging `pc` to other files for now to preserve count data.
#df <- left_join(aco_pc, pc)
```
```{r}
df_abund %>%
  uncount(pca)
```
Only joining the `aco` and `plots` data files gives the correct number of observations.

```{r}
pc_abund <- df_abund %>%
  group_by(aco) %>%
  summarize(n_ind = sum(pca))

pc_abund

pc_abund %>%
  distinct(n_ind)
```
Grouped by individual cover board (`aco`), of which there are 300.  This still gives us 241 P. cinereus observed (`n_ind` >= 1), with counts per cover board being 0-7.  I may join the `pc` dataframe (which includes morphometrics) to the `plots` dataframe separately to preserve the correct counts.  I was unable to find a join method that correctly merged the two dataframes without inflating count data.

Group by appropriate category then calculate abundance individual as `summarize(n_ind = sum(pca))` to avoid duplicates.

```{r}
write_csv(df_abund, "/cloud/project/data/df_abund.csv")
```

