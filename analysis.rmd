---
title: "Red-backed salamander abundance and distribution in north-central Massachusetts"
author: "Joshua A. Harkness"
date: "2024-02-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#install.packages(gridExtra)
library(tidyverse)
library(broom)
library(stringr)
library(sf)
library(ggspatial)
library(readxl)
library(GGally)
library(gridExtra)
library(tidymodels)
library(MASS)
library(simfit)
```

#### Load data
```{r}
df <- read_csv("/cloud/project/data/df.csv")
```
## P. cinereus abundance
#### Calculate abundance
```{r}
pc_abund <- df %>%
  group_by(ft, site, plot, asn, aco) %>%
  count(pca, sort = TRUE) %>%
  summarise(n_ind = n*pca) %>%
  arrange(desc(n_ind))

pc_abund
```

#### Join dataframes
```{r}
df_pc <- left_join(df, pc_abund)
```

### Modeling
Using negative binomial framework here as it provided the lowest AICs in model testing, given highly skewed count data with variance not equal to mean.  Quasi-Poisson may also be applicable here.

#### Environmental Model with no interaction effects
```{r}
nb_env <- glm.nb(n_ind ~ ts + ba + st.ha + canopy.cover + avg.dc + vcwd.con + cwd.con + tot.snags + avg.snag.dbh + soil.ph + soilt + airt + rh, data = df_pc)
summary(nb_env)
```
#### Environmental model with forest type effect
```{r}
nb_env_effect1 <- glm.nb(n_ind ~ soil.ph * ts * ba * st.ha * canopy.cover + avg.dc + vcwd.con * cwd.con + tot.snags + avg.snag.dbh + soilt * airt * rh, data = df_pc)
summary(nb_env_effect1)
```
#### Are P. cinereus more abundant in hemlock or mixed deciduous forests?

```{r}
df_pc %>%
  ggplot(aes(x = ts, y = n_ind)) +
  geom_jitter(alpha = 0.25) +
  geom_smooth(method = "lm")
```
Simple linear model is not a good fit, so we'll also try this with a negative binomial regression.

```{r}
nb1 <- glm.nb(n_ind ~ ts, data = df_pc)
summary(nb1)
pred.plot(nb1, xpred = "ts") +
  scale_y_continuous("Count", 
                     labels = function(x) format(x, scientific = FALSE)) +
  scale_x_continuous("Percent hemlock") +
  theme_bw()
```


## P. cinereus Morphometrics
```{r}
df_pc %>%
  ggplot(aes(x = ft, y = wt, fill = ft)) +
  geom_boxplot()
```
```{r}
t.test(df_pc$wt ~ df_pc$ft)
```
Weight is not significantly different between forest types.

```{r}
df_pc %>%
  ggplot(aes(x = ft, y = svl, fill = ft)) +
  geom_boxplot()
```
```{r}
t.test(df_pc$svl ~ df_pc$ft)
```
Snout-vent length also not significantly different between forest types.

## Biodiversity
```{r}
herps <- read_csv("/cloud/project/data/hf131-06-herps.csv")

sp <- left_join(df, herps)
```
```{r}
herps %>%
  count(species)
```
Add PLCI to species with case_when or if_else
```{r}

```

Then use iNEXT for plotting rarefaction/sp estimators
