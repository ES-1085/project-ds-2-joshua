---
title: "Red-backed salamander abundance and distribution in north-central Massachusetts"
author: "Joshua A. Harkness"
date: "2024-02-02"
output: github_document
---


## 1. Introduction
For my final project in Data Science II, I decided to use a dataset comparing eastern red-backed salamander (Plethodon cinereus) abundance and distribution across different forest types in north-central Massachusetts.  Harvard Forest has been involved in a number of observational and experimental studies of changes in forest composition, structure, and biodiversity relating to loss of important tree species due to introduced pathogens; one of their main projects has been the experimental removal of hemlock (Tsuga canadensis) to simulate the loss of this species due to hemlock woolly adelgid (HWA) (Adelges tsugae).  This project is one of several observational studies relating to biodiversity in hemlock-dominated forest stands, and how plant, invertebrate, and vertebrate communities may be affected by the loss of hemlock.

Data was collected in 2005 by Brooks Mathewson and Elizabeth Colburn on properties owned by Harvard Forest and on state-owned land in north-central Massachusetts, within a 20-mile radius of the main Harvard Forest property in Petersham.  Fifteen sites occupying a variety of mid-elevation forested areas were selected.  Two paired, fixed-radius df (each 0.33ha in area) were located within each site using random sampling stratified by forest type; one site of the pair being in a hemlock-dominated stand, the other being in a mixed deciduous stand.  Hemlock-dominated sites were defined as having >50% of total basal area (BA) being hemlock, and mixed deciduous as <25% of total BA being hemlock.  Each plot center was used as an intersection between two perpendicular 50m transects, along which pairs of cover boards (ACO stations) were placed at the transect ends and intersection.  Cover boards were sampled once every 2-3 weeks from June 13th until November 4th 2005.  All amphibian and reptile species detected under cover boards were recorded along with basic morphometrics; for P. cinereus, total length, snout-vent length, weight, phase, and sex were recorded.  For all other herps, snout-vent length was recorded.

Data was published in six separate .csv files, one including plot number, site, topography, location, forest type, etc., another, one including forest inventory data from each plot, one including coarse woody debris (CWD) measurements for each plot, one including all cover board observations, one including P. cinereus abundance and morphometrics, and another including abundance and morphometrics for all other herps observed.

## 2. Data
Data citation: Mathewson B, Colburn E. 2023. Eastern Redback Salamander Abundance in North Central Massachusetts 2005. Harvard Forest Data Archive: HF131 (v.14). Environmental Data Initiative: https://doi.org/10.6073/pasta/4107874d4233c79b05929c7a93a60ca4.

### Load Packages
```{r load-packages, message = FALSE}
#install.packages(gridExtra)
library(tidyverse)
library(broom)
library(stringr)
library(sf)
library(ggspatial)
library(readxl)
library(GGally)
library(gridExtra)
```

### Load Datafiles from GitHub Repository
```{r load-data-files, message = FALSE}
plots <- read_csv("/cloud/project/data/hf131-01-plot.csv")
trees <- read_csv("/cloud/project/data/hf131-02-tree.csv")
cwd <- read_csv("/cloud/project/data/hf131-03-cwd.csv")
aco <- read_csv("/cloud/project/data/hf131-04-aco.csv")
pc <- read_csv("/cloud/project/data/hf131-05-pc-abund.csv")
herps <- read_csv("/cloud/project/data/hf131-06-herps.csv")
```

```{r glimpse-data-files}
glimpse(plots)
glimpse(trees)
glimpse(cwd)
glimpse(aco)
glimpse(pc)
glimpse(herps)
```

```{r join-data-files}
# joining all except herps for now
plots_aco <- left_join(plots, aco)
plots_aco_cwd <- left_join(plots_aco, cwd)
plots_aco_cwd_trees <- left_join(plots_aco_cwd, trees)
df <- left_join(plots_aco_cwd_trees, pc)

write_csv(df, "/cloud/project/data/df.csv")
```
## 3. Ethics review
Limitations:  Sampling design has no way to identify 'recaptures'; if the same salamanders were staying at or returning to the same cover board across multiple sampling days, there is no definitive way to identify how these individuals are impacting counts.  The 2-3 week sampling interval may actually help to address this pseudoreplication, since there may be some turnover in individuals salamanders using a cover board station.  Data was collected over only a single season and may not be representative of P. cinereus population dynamics on a longer scale; another year may show different patterns of abundance and distribution and some factor other than forest type may be involved.  Another limitation is that by introducing a novel habitat feature (cover boards), use of existing habitat features by herps is altered.  Since this is an observational and not experimental study, there is no way to infer causation between any variables.

Reasons for using data:  I wanted to work with an ecological dataset for this project that encompassed a broad array of species-environment interactions.  I chose this specific dataset out of personal interest in forest ecology and herpetology; and am using it to learn more about different techniques for analysis of ecological data, as well as to learn more about research design for ecological sampling.  I declare no conflicting interests.

Potential impacts:  This data was not collected on human subjects.  It does, however, have some potential impacts on how we address macroinvertebrate and herpetological communities in forest management, in specific regards to retaining habitat features that aid in supporting these communities, especially in the face of climate change and introduced tree pests and pathogens.

## 4. Data analysis plan
### Convert degrees, decimal minutes to decimal degrees
R did not recognize the degree signs used in the `hf131-01-plot.csv` file.  I wasn't able to find a simple function that converted degrees, decimal minutes to decimal degrees, so I used several string functions to replace the characters read in in place of the degree sign with a delimiter character, then calculate the difference manually.

```{r str-extract-coords}
coords <- df %>%
  mutate(lat_deg = as.numeric(str_extract(lat, "\\d+(?=\xb0)")),
         lat_dm = as.numeric(str_extract(lat, "(?<=\xb0)\\d+.\\d+")),
         long_deg = as.numeric(str_extract(long, "\\d+(?=\xb0)")),
         long_dm = as.numeric(str_extract(long, "(?<=\xb0)\\d+.\\d+"))) %>%
  select(site, plot, asn, aco, lat_deg, lat_dm, long_deg, long_dm)
```

```{r convert-lat-long-to-dd}
coords <- coords %>%
  mutate(lat_dd = lat_deg + lat_dm / 60,
         long_dd = long_deg + long_dm / 60)

# this converts all values in the the `long_dd` variable to negative.
coords$lat_dd <- as.numeric(coords$lat_dd)
coords$long_dd <- as.numeric(coords$long_dd)*(-1)

# this saves the new coordinates in decimal degrees to the main dataframe, but it leaves a separate smaller `coords` dataframe to work with.
df$lat_dd <- as.numeric(coords$lat_dd)
df$long_dd <- as.numeric(coords$long_dd)

coords <- coords %>%
  select(site, plot, asn, aco, lat_dd, long_dd)

write_csv(coords, path = "/cloud/project/data/coords.csv")
```

I will also load in shapefiles of Massachusetts town boundaries, along with state-owned land, and any applicable layers in the HF GIS.
```{r load-mass_towns-shapefile}
mass_towns <- st_read("/cloud/project/data/Community Boundaries (Towns) from Survey Points.shp")
```

I had some issues getting the points to plot correctly with the shapefile, so I am transforming it to GCS WGS1984 (EPSG: 4326).

```{r transform-crs-mass_towns}
mass_towns <- st_transform(mass_towns, "+init=epsg:4326")
```

```{r plot-mass_towns-coords}
ggplot(mass_towns) +
  geom_sf() +
  geom_point(data = coords, (aes(x = long_dd, y = lat_dd)), alpha = 0.5)
```
Zoomed-in view:
```{r}
ggplot(mass_towns) +
  geom_sf() +
  geom_point(data = coords, (aes(x = long_dd, y = lat_dd, color = site)), shape = 18, alpha = 0.5) +
  xlim(-72.5, -71.75) +
  ylim(42.4, 42.75)
```

Based on the coordinates plotted here, data was collected within twenty miles of Harvard Forest (HF) in Petersham, MA.  The central clusters of points appear to be from the HF properties in Petersham; the southeastern cluster is from Mount Wachusett, and the northern and western clusters on state land in the towns of Northfield, Warwick, and Royalston.  This provides a useful reference as to the spatial scale of this project.


### Preliminary hypotheses
#### P. cinereus abundance is different between hemlock-dominated and mixed deciduous forest types.

T-test/simple linear model.
Explanatory variable: forest type
Response variable: P. cinereus abundance

#### Hemlock forests offer an important refugae for P. cinereus by shading the forest floor and maintaining more stable soil temperature.

Generalized linear model.
Explanatory variable: air temperature, forest type
Response variables: soil temperature

#### P. cinereus abundance is positively correlated with older, more structurally complex forest stands.

Multivariate regression.
Explanatory variables: basal area, coarse woody debris, mean stand diameter.
Response variable: P. cinereus abundance.

#### P. cinereus abundance is positively correlated with higher volumes of coarse woody debris.

Generalized linear model (Poisson).
Explanatory variable: coarse woody debris volume
Response variable: P. cinereus abundance

#### P. cinereus sexes are morphologically similar between forest types.

Multivariate regression/MANOVA (if applicable)
Explanatory variables: sex, forest type
Response variables: total length, snout-vent length, weight (as matrix if MANOVA).

### Exploratory visualizations
#### Forest Structure / Environmental conditions

```{r plot-hists-env-cond, message = FALSE, warning = FALSE}
p1 <- ggplot(df, aes(x = ba)) +
  geom_histogram(fill = "skyblue", color = "black")
p2 <- ggplot(df, aes(x = st.ha)) +
  geom_histogram(fill = "skyblue", color = "black")
p3 <- ggplot(df, aes(x = ts)) +
  geom_histogram(fill = "skyblue", color = "black")
p4 <- ggplot(df, aes(x = canopy.cover)) +
  geom_histogram(fill = "skyblue", color = "black")
p5 <- ggplot(df, aes(x = vcwd)) +
  geom_histogram(fill = "skyblue", color = "black")
p6 <- ggplot(df, aes(x = soil.ph)) +
  geom_histogram(fill = "skyblue", color = "black")
p7 <- ggplot(df, aes(x = soilt)) +
  geom_histogram(fill = "skyblue", color = "black")
p8 <- ggplot(df, aes(x = airt)) +
  geom_histogram(fill = "skyblue", color = "black")
p9 <- ggplot(df, aes(x = dbh)) +
  geom_histogram(fill = "skyblue", color = "black")

grid.arrange(p1, p2, p3, p4, p5, p6, p7, p8, p9)
```

```{r boxplot-soilph-ft}
df %>%
  ggplot(aes(x = site, y = soil.ph, fill = ft)) +
  geom_boxplot()
```

Boxplot of soil pH by site.  Boxes are colored per forest type ("TS" = Tsuga canadensis dominated (>50% BA), "MD" = mixed-deciduous forest (hemlock <25% BA)).  Hemlock dominated stands are consistently more acidic than mixed deciduous stands with some outliers.

```{r boxplot-ba-ft}
df %>%
  ggplot(aes(x = site, y = ba, fill = ft)) +
  geom_boxplot()
```

Boxplot of basal area (m2/ha) by site.  Hemlock dominated sites have consistently higher BA than mixed deciduous sites.

```{r plot-vcwd-ba-ft}
df %>%
  ggplot(aes(y = vcwd, x = ba, color = ft)) +
  geom_jitter() +
  theme_bw() +
  labs(title = "Coarse Woody Debris and Basal Area",
       subtitle = "By Forest Type",
       x = "Basal area (m2/ha)",
       y = "CWD volume (m3)")
```

Coarse woody debris volume is higher in stands with lower basal area, which is reasonable given that areas that were recently affected by blowdown events should have higher CWD and lower BA, but very dense stands (high BA) should have less CWD.  Coloring the points by forest type, we see that it is primarily hemlock-dominated df that have high BA and low CWD, and hardwood sites have lower BA and higher CWD volume.

#### Plethodon cinereus abundance
```{r create-pc_abund}
# creating new dataframe called pc_abund for P. cinereus abundance, grouped by plot, site, forest type, and sex.
pc_abund <- df %>%
  group_by(plot, site, ft, sex) %>%
  drop_na(pca) %>%
  filter(pca != 0) %>%
  count(pca, sort = TRUE) %>%
  summarise(n_ind = sum(n*pca))

pc_abund
```

```{r calc-mean-sd-ft-and-boxplot-n_ind-ft}
pc_abund %>%
  group_by(ft) %>%
  summarise(mean = mean(n_ind),
            sd = sd(n_ind))

pc_abund %>%
  group_by(ft) %>%
  ggplot(aes(x = ft, y = n_ind)) +
  geom_boxplot() +
  geom_jitter()
```

P. cinereus abundance is higher in hemlock-dominated plots (mean = 13 +/- 15 individuals), than in mixed deciduous forest (mean = 9 +/- 6 individuals).  This shows us that while hemlock-dominated plots had more individuals, they also had greater variation in abundance.

#### Morphometrics
Plethodon cinereus:
```{r plot-hists-morpho, warning = FALSE}
p1 <- ggplot(df, aes(x = tl)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(x = "Total length (mm)")
p2 <- ggplot(df, aes(x = svl)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(x = "Snout-vent length (mm)")
p3 <- ggplot(df, aes(x = wt)) +
  geom_histogram(fill = "skyblue", color = "black") +
  labs(x = "Weight (cg)")

grid.arrange(p1, p2, p3)
```

The total length, snout-vent length, and weight variables are all normally distributed, with some left skew in the length variables.

```{r plot-ggpairs-morpho, warning = FALSE}
df %>%
  ggpairs(aes(color = sex), columns = c("wt", "tl", "svl"))
```

There appears to be a non-linear relationship between weight and total length, as well as between weight and snout-vent length.  The relationship between total length and snout-vent length is linear.  Females appear to be somewhat longer and heavier than males.

Other herps:
```{r plot-herps-tl-sp}
herps %>%
  ggplot(aes(x = species, y = tl, fill = species)) +
  geom_boxplot() +
  coord_flip()
```
