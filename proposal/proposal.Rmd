---
title: "Red-backed salamander abundance and distribution in north-central Massachusetts"
author: "Joshua A. Harkness"
date: "2024-02-02"
output: github_document
---

```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(stringr)
library(sf)
library(ggspatial)
library(readxl)
```

## 1. Introduction



## 2. Data
### Load Packages

### Load Datafiles from GitHub Repository
```{r}
plots <- read_csv("/cloud/project/data/hf131-01-plot.csv")
cwd <- read_csv("/cloud/project/data/hf131-03-cwd.csv")
aco <- read_csv("/cloud/project/data/hf131-04-aco.csv")
pc <- read_csv("/cloud/project/data/hf131-05-pc-abund.csv")
herps <- read_csv("/cloud/project/data/hf131-06-herps.csv")
```

```{r}
glimpse(plots)
glimpse(aco)
glimpse(pc)
glimpse(herps)
```

### Convert degrees, minutes, seconds to decimal degrees

```{r}
#latitude
plots <- plots %>%
  mutate(lat = str_replace_all(lat, "\xb0", ":"))

plots <- plots %>%
  mutate(lat = str_remove_all(lat, "N"))

plots <- plots %>%
  mutate(lat = str_remove_all(lat, "'"))

plots <- plots %>%
  mutate(lat = str_squish(lat))

#longitude
plots <- plots %>%
  mutate(long = str_replace_all(long, "\xb0", ":"))

plots <- plots %>%
  mutate(long = str_remove_all(long, "W"))

plots <- plots %>%
  mutate(long = str_remove_all(long, "'"))

plots <- plots %>%
  mutate(long = str_squish(long))
```

```{r}
#extract values to create separate columns for degrees, decimal minutes, and hemisphere


plots <- plots %>%
  mutate(lat_deg = str_extract_all(plots$lat, "..(?=:)"),
         lat_dm = str_extract_all(plots$lat, "(?<=:)......"),
         long_deg = str_extract_all(plots$long, "..(?=:)"),
         long_dm = str_extract_all(plots$long, "(?<=:)......"))

plots$lat_deg <- as.numeric(plots$lat_deg)
plots$lat_dm <- as.numeric(plots$lat_dm)
plots$long_deg <- as.numeric(plots$long_deg)
plots$long_dm <- as.numeric(plots$long_dm)
```

```{r}
coords <- plots %>%
  select(plot, lat_deg, lat_dm, long_deg, long_dm) %>%
  mutate(lat_dd = lat_deg + lat_dm / 60,
         long_dd = long_deg + long_dm / 60) %>%
  select(plot, lat_dd, long_dd)

coords$long_dd <- coords$long_dd*(-1)

plots$lat_dd <- coords$lat_dd
plots$long_dd <- coords$long_dd
```

```{r}
coords %>%
  ggplot(aes(x = long_dd, y = lat_dd)) +
  geom_point()
```


```{r}
mass_towns <- st_read("/cloud/project/data/Community Boundaries (Towns) from Survey Points.shp")
```
```{r}
ggplot(mass_towns) +
  geom_sf() #+
#  geom_point(data = coords, (aes(x = long_dd, y = lat_dd)), color = "black", alpha = 0.5)
```

Not sure why I'm getting this mismatch in coordinates.  My points appear in the correct location when plotted with X/Y coordinates, but they're showing up about 8 degrees too far south and a little west when plotted with this shapefile of Massachusetts towns.  Maybe because the points don't have a coordinate reference system assigned?  I haven't had this issue before though.  I'll try loading these points into ArcGIS to see if I figure out the source of the issue.


### Join data files
```{r}
join_step1 <- full_join(plots, )
```


### Exploratory Visualizations

```{r}
plots_stations %>%
  ggplot(aes(x = site, y = soil.ph, fill = ft)) +
  geom_boxplot()
```

```{r}
plots_stations %>%
  ggplot(aes(x = site, y = ba, fill = ft)) +
  geom_boxplot()
```
```{r}
plots_stations %>%
  ggplot(aes(x = ft, y = soilt, fill = ft)) +
  geom_boxplot() +
  scale_color_viridis_c()
```

```{r}
plots %>%
  ggplot(aes(y = vcwd, x = ba)) +
  geom_col() +
  theme_bw() +
  labs(title = "Coarse Woody Debris and Basal Area",
       x = "Basal area (m2/ha)",
       y = "CWD volume (m3)")
```

### Plethodon cinereus morphometrics

```{r}
pc %>%
  ggplot(aes(x = tl, y = wt)) +
  geom_point() +
  geom_smooth()
```
```{r}
pc %>%
  drop_na(sex) %>%
  ggplot(aes(x = sex, y = wt)) +
  geom_boxplot()
```

### Other herp morphometrics
```{r}
herps %>%
  count(species, sort = TRUE)
```


```{r}
herps %>%
  ggplot(aes(x = species, y = tl, fill = species)) +
  geom_boxplot() +
  coord_flip()
```


## 3. Ethics review

## 4. Data analysis plan



