---
title: "Red-backed salamander abundance and distribution in north-central Massachusetts"
author: "Joshua A. Harkness"
date: "2024-02-02"
output: github_document
---


## 1. Introduction
For my final project in Data Science II, I decided to use a dataset comparing eastern red-backed salamander (Plethodon cinereus) abundance and distribution across different forest types in north-central Massachusetts.  Harvard Forest has been involved in a number of observational and experimental studies of changes in forest composition, structure, and biodiversity relating to loss of important tree species due to introduced pathogens; one of their main projects has been the experimental removal of hemlock (Tsuga canadensis) to simulate the loss of this species due to hemlock woolly adelgid (HWA) (Adelges tsugae).  This project is one of several observational studies relating to biodiversity in hemlock-dominated forest stands, and how plant, invertebrate, and vertebrate communities may be affected by the loss of hemlock.

Data was collected in 2005 by Brooks Mathewson and Elizabeth Colburn on properties owned by Harvard Forest and on state-owned land in north-central Massachusetts, within a 20-mile radius of the main Harvard Forest property in Petersham.  Fifteen sites occupying a variety of mid-elevation forested areas were selected.  Two paired, fixed-radius plots (each 0.33ha in area) were located within each site using random sampling stratified by forest type; one site of the pair being in a hemlock-dominated stand, the other being in a mixed deciduous stand.  Hemlock-dominated sites were defined as having >50% of total basal area (BA) being hemlock, and mixed deciduous as <25% of total BA being hemlock.  Each plot center was used as an intersection between two perpendicular 50m transects, along which pairs of cover boards (ACO stations) were placed at the transect ends and intersection.  Cover boards were sampled once every 2-3 weeks from June 13th until November 4th 2005.  All amphibian and reptile species detected under cover boards were recorded along with basic morphometrics; for P. cinereus, total length, snout-vent length, weight, phase, and sex were recorded.  For all other herps, snout-vent length was recorded.

Data was published in six separate .csv files, one including plot number, site, topography, location, forest type, etc., another, one including forest inventory data from each plot, one including coarse woody debris (CWD) measurements for each plot, one including all cover board observations, one including P. cinereus abundance and morphometrics, and another including abundance and morphometrics for all other herps observed.

## 2. Data
Data citation: Mathewson B, Colburn E. 2023. Eastern Redback Salamander Abundance in North Central Massachusetts 2005. Harvard Forest Data Archive: HF131 (v.14). Environmental Data Initiative: https://doi.org/10.6073/pasta/4107874d4233c79b05929c7a93a60ca4.

### Load Packages
```{r load-packages, message = FALSE}
library(tidyverse)
library(broom)
library(stringr)
library(sf)
library(ggspatial)
library(readxl)
```

### Load Datafiles from GitHub Repository
```{r load-data-files, message = FALSE}
plots <- read_csv("/cloud/project/data/hf131-01-plot.csv")
trees <- read_csv("/cloud/project/data/hf131-02-tree.csv")
cwd <- read_csv("/cloud/project/data/hf131-03-cwd.csv")
aco <- read_csv("/cloud/project/data/hf131-04-aco.csv")
pc <- read_csv("/cloud/project/data/hf131-05-pc-abund.csv")
herps <- read_csv("/cloud/project/data/hf131-06-herps.csv")
```

```{r glimpse-data-files}
glimpse(plots)
glimpse(trees)
glimpse(cwd)
glimpse(aco)
glimpse(pc)
glimpse(herps)
```


## 3. Ethics review
Limitations:  Sampling design has no way to identify 'recaptures'; if the same salamanders were staying at or returning to the same cover board across multiple sampling days, there is no definitive way to identify how these individuals are impacting counts.  The 2-3 week sampling interval may actually help to address this pseudoreplication, since there may be some turnover in individuals salamanders using a cover board station.  Data was collected over only a single season and may not be representative of P. cinereus population dynamics on a longer scale; another year may show different patterns of abundance and distribution and some factor other than forest type may be involved.  Since this is an observational and not experimental study, there is no way to infer causation between any variables.

## 4. Data analysis plan
### Convert degrees, minutes, seconds to decimal degrees

```{r}
#latitude
plots <- plots %>%
  mutate(lat = str_replace_all(lat, "\xb0", ":"))

plots <- plots %>%
  mutate(lat = str_remove_all(lat, "N"))

plots <- plots %>%
  mutate(lat = str_remove_all(lat, "'"))

plots <- plots %>%
  mutate(lat = str_squish(lat))

#longitude
plots <- plots %>%
  mutate(long = str_replace_all(long, "\xb0", ":"))

plots <- plots %>%
  mutate(long = str_remove_all(long, "W"))

plots <- plots %>%
  mutate(long = str_remove_all(long, "'"))

plots <- plots %>%
  mutate(long = str_squish(long))
```

```{r}
#extract values to create separate columns for degrees, decimal minutes, and hemisphere

plots <- plots %>%
  mutate(lat_deg = str_extract_all(plots$lat, "..(?=:)"),
         lat_dm = str_extract_all(plots$lat, "(?<=:)......"),
         long_deg = str_extract_all(plots$long, "..(?=:)"),
         long_dm = str_extract_all(plots$long, "(?<=:)......"))

plots$lat_deg <- as.numeric(plots$lat_deg)
plots$lat_dm <- as.numeric(plots$lat_dm)
plots$long_deg <- as.numeric(plots$long_deg)
plots$long_dm <- as.numeric(plots$long_dm)
```

```{r}
coords <- plots %>%
  select(plot, lat_deg, lat_dm, long_deg, long_dm) %>%
  mutate(lat_dd = lat_deg + lat_dm / 60,
         long_dd = long_deg + long_dm / 60) %>%
  select(plot, lat_dd, long_dd)

coords$long_dd <- coords$long_dd*(-1)

plots$lat_dd <- coords$lat_dd
plots$long_dd <- coords$long_dd
```

```{r}
coords %>%
  ggplot(aes(x = long_dd, y = lat_dd)) +
  geom_point()
```

Based on the coordinates plotted here, data was collected within about fifteen miles of Harvard Forest (HF) in Petersham, Massachusetts.  The central clusters of points appear to be from the HF properties in Petersham; the southeastern cluster is from Mount Wachusett, and the northern and western clusters on state land in the towns of Northfield, Warwick, and Royalston.  This provides a useful reference as to the spatial scale of this project.

```{r}
mass_towns <- st_read("/cloud/project/data/Community Boundaries (Towns) from Survey Points.shp")
```
```{r}
ggplot(mass_towns) +
  geom_sf() +
  geom_point(data = coords, (aes(x = long_dd, y = lat_dd)), color = "black", alpha = 0.5)
```

Not sure why I'm getting this mismatch in coordinates.  My points appear in the correct location when plotted with X/Y coordinates, but they're showing up about 8 degrees too far south and a little west when plotted with this shapefile of Massachusetts towns.  Maybe because the points don't have a coordinate reference system assigned?  I haven't had this issue before though.  I'll try loading these points into ArcGIS to see if I figure out the source of the issue.


### Join data files
```{r}
# joining all except herps for now
plots_aco <- full_join(plots, aco)
plots_aco_cwd <- full_join(plots_aco, cwd)
plots_aco_cwd_trees <- full_join(plots_aco_cwd, trees)
df <- full_join(plots_aco_cwd_trees, pc)
```


### Forest Structure / Environmental conditions
```{r}
df %>%
  ggplot(aes(x = site, y = soil.ph, fill = ft)) +
  geom_boxplot()
```

Boxplot of soil pH by site.  Boxes are colored per forest type ("TS" = Tsuga canadensis dominated (>50% BA), "MD" = mixed-deciduous forest (hemlock <25% BA)).  Hemlock dominated stands are consistently more acidic than mixed deciduous stands with some outliers.

```{r}
df %>%
  ggplot(aes(x = site, y = ba, fill = ft)) +
  geom_boxplot()
```

Boxplot of basal area (m2/ha) by site.  Hemlock dominated sites have consistently higher BA than mixed deciduous sites.

```{r}
df %>%
  ggplot(aes(y = vcwd, x = ba, color = ft)) +
  geom_jitter() +
  theme_bw() +
  labs(title = "Coarse Woody Debris and Basal Area",
       x = "Basal area (m2/ha)",
       y = "CWD volume (m3)")
```
Coarse woody debris volume is higher in stands with lower basal area, which is reasonable given that areas that were recently affected by blowdown events should have higher CWD and lower BA, but very dense stands (high BA) should have less CWD.  Coloring the points by forest type, we see that it is primarily hemlock-dominated plots that have high BA and low CWD, and hardwood sites have lower BA and higher CWD volume.

#### Is soil temp more or less associated with air temperature in hemlock dominated vs mixed-deciduous plots?
```{r warning = FALSE}
df %>%
  filter(ft != "NA") %>%
  ggplot(aes(x = airt, y = soilt, shape = ft, color = ft)) +
  geom_point() +
  geom_smooth(method = "lm", fullrange = TRUE, se = FALSE) +
  labs(title = "Soil temp as function of air temp",
       subtitle = "In hemlock and mixed deciduous forest",
       x = "Air temp (°C)",
       y = "Soil temp (°C)")
```
Modelling soil temperature as a function of air temperature and forest type indicates that there is not much sheltering effect of hemlock-dominated canopy cover on soil temperature, which could be an important factor for P. cinereus abundance.



### Plethodon cinereus abundance
63
```{r}
df %>%
  group_by(plot, site) %>%
  drop_na(pca) %>%
  filter(pca != 0) %>%
  count(pca, sort = TRUE) %>%
  summarise(n_ind = sum(n*pca)) %>%
  arrange(desc(n_ind))
```

```{r}
df %>%
  group_by(ft) %>%
  drop_na(pca) %>%
  filter(pca != 0) %>%
  count(pca, sort = TRUE) %>%
  summarise(n_ind = sum(n*pca)) %>%
  group_by(ft) %>%
  summarise(mean = mean(n_ind))
```


P. cinereus abundance is higher in hemlock dominated forest (mean = 53 individuals), than in mixed deciduous forest (mean = 37 individuals).

```{r}
df %>%
  group_by(vcwd) %>%
  drop_na(pca) %>%
  filter(pca != 0) %>%
  count(pca) %>%
  ggplot(aes(x = vcwd, y = n)) +
  geom_jitter() +
  geom_smooth(method = "lm") +
  labs(title = "P. cinereus abundance",
       y = "n Observations",
       x = "Volume CWD (m2)")
```

P. cinereus abundance as function of soil ph
```{r}
df %>%
  group_by(soil.ph) %>%
  drop_na(pca) %>%
  filter(pca != 0) %>%
  count(pca, sort = TRUE) %>%
  ggplot(aes(x = soil.ph, y = n)) +
  geom_jitter() +
  geom_smooth()
```

```{r}
df %>%
  group_by(soil.ph, wt) %>%
  drop_na(wt) %>%
  ggplot(aes(x = soil.ph, y = wt)) +
  geom_point()
```





### Other herp morphometrics
```{r}
herps %>%
  count(species, sort = TRUE)
```


```{r}
herps %>%
  ggplot(aes(x = species, y = tl, fill = species)) +
  geom_boxplot() +
  coord_flip()
```


```{r}
df %>%
  ggplot(aes(x = vcwd, y = wt)) +
  geom_point()
```




